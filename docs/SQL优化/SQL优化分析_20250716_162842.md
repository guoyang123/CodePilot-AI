# SQLä¼˜åŒ–åˆ†ææŠ¥å‘Š

## åŸºæœ¬ä¿¡æ¯
- **ç”Ÿæˆæ—¶é—´**: 2025-07-16 16:28:42
- **æ•°æ®åº“ç±»å‹**: MySQL
- **SQLé•¿åº¦**: 242 å­—ç¬¦

## åŸå§‹SQLè¯­å¥

```sql

    SELECT u.id, u.name, u.email, p.title, p.content, p.created_at
    FROM users u
    LEFT JOIN posts p ON u.id = p.user_id
    WHERE u.status = 'active'
    AND p.created_at > '2024-01-01'
    ORDER BY p.created_at DESC
    LIMIT 100
    
```

## å»ºè¡¨è¯­å¥

```sql

    CREATE TABLE users (
        id INT PRIMARY KEY AUTO_INCREMENT,
        name VARCHAR(100) NOT NULL,
        email VARCHAR(255) UNIQUE NOT NULL,
        status ENUM('active', 'inactive') DEFAULT 'active',
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
    
    CREATE TABLE posts (
        id INT PRIMARY KEY AUTO_INCREMENT,
        user_id INT NOT NULL,
        title VARCHAR(255) NOT NULL,
        content TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (user_id) REFERENCES users(id)
    );
    
```

## SQLåˆ†æç»“æœ

æˆ‘ä»¬æ¥å¯¹ä»¥ä¸‹ SQL è¯­å¥è¿›è¡Œè¯¦ç»†åˆ†æï¼š

---

### ğŸ“Œ åŸå§‹SQLè¯­å¥
```sql
SELECT u.id, u.name, u.email, p.title, p.content, p.created_at
FROM users u
LEFT JOIN posts p ON u.id = p.user_id
WHERE u.status = 'active'
AND p.created_at > '2024-01-01'
ORDER BY p.created_at DESC
LIMIT 100;
```

---

## ä¸€ã€SQLè¯­å¥çš„åŠŸèƒ½å’Œç›®çš„

è¯¥æŸ¥è¯¢çš„ç›®çš„æ˜¯ï¼š

> **è·å–æœ€è¿‘æ´»è·ƒç”¨æˆ·ï¼ˆ`status = 'active'`ï¼‰ä¸­ï¼Œåœ¨ 2024 å¹´ 1 æœˆ 1 æ—¥ä¹‹åå‘è¡¨çš„æœ€å¤š 100 ç¯‡å¸–å­ä¿¡æ¯ï¼Œå¹¶æŒ‰æ—¶é—´å€’åºæ’åˆ—ã€‚**

è¿™ä¸ªæŸ¥è¯¢å¯ä»¥ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š
- å±•ç¤ºæœ€æ–°å‘å¸ƒçš„éƒ¨åˆ†ç”¨æˆ·å¸–å­ã€‚
- æ„å»ºä¸€ä¸ªâ€œæœ€è¿‘æ´»è·ƒç”¨æˆ·å†…å®¹å±•ç¤ºâ€æ¨¡å—ã€‚
- ä¸ºåå°ç®¡ç†æä¾›æ•°æ®ç»Ÿè®¡æ”¯æŒã€‚

---

## äºŒã€æ¶‰åŠçš„è¡¨å’Œå­—æ®µ

| è¡¨å     | å­—æ®µå        | ç±»å‹         | å«ä¹‰                         |
|----------|---------------|--------------|------------------------------|
| `users`  | id            | INT          | ç”¨æˆ·å”¯ä¸€ID                   |
|          | name          | VARCHAR(100) | ç”¨æˆ·åç§°                     |
|          | email         | VARCHAR(255) | ç”¨æˆ·é‚®ç®±ï¼Œå”¯ä¸€               |
|          | status        | ENUM         | ç”¨æˆ·çŠ¶æ€ï¼ˆactive/inactiveï¼‰  |
|          | created_at    | TIMESTAMP    | ç”¨æˆ·åˆ›å»ºæ—¶é—´                 |
| `posts`  | id            | INT          | å¸–å­ID                       |
|          | user_id       | INT          | å…³è”ç”¨æˆ·ID                   |
|          | title         | VARCHAR(255) | å¸–å­æ ‡é¢˜                     |
|          | content       | TEXT         | å¸–å­å†…å®¹                     |
|          | created_at    | TIMESTAMP    | å¸–å­å‘å¸ƒæ—¶é—´                 |

---

## ä¸‰ã€æŸ¥è¯¢é€»è¾‘åˆ†æ

è¯¥æŸ¥è¯¢ä½¿ç”¨äº†ä»¥ä¸‹ç»“æ„ï¼š

1. **LEFT JOIN**ï¼šå°† `users` å’Œ `posts` è¡¨è¿æ¥èµ·æ¥ï¼Œå³ä½¿æŸä¸ªç”¨æˆ·æ²¡æœ‰å‘å¸–ï¼Œä¹Ÿä¿ç•™å…¶è®°å½•ã€‚
2. **WHERE è¿‡æ»¤æ¡ä»¶**ï¼š
   - åªé€‰æ‹©çŠ¶æ€ä¸º `'active'` çš„ç”¨æˆ·ï¼›
   - åªé€‰æ‹©å¸–å­åˆ›å»ºæ—¶é—´åœ¨ `'2024-01-01'` ä¹‹åçš„å†…å®¹ã€‚
3. **ORDER BY**ï¼šæŒ‰ç…§å¸–å­å‘å¸ƒæ—¶é—´å€’åºæ’åˆ—ã€‚
4. **LIMIT**ï¼šé™åˆ¶ç»“æœé›†æœ€å¤§ä¸º 100 æ¡ã€‚

âš ï¸ **æ³¨æ„ç‚¹**ï¼šè™½ç„¶ç”¨äº† `LEFT JOIN`ï¼Œä½† `WHERE` å­å¥ä¸­å¯¹ `p.created_at` æœ‰éç©ºåˆ¤æ–­ï¼ˆéšå«ï¼‰ï¼Œè¿™å®é™…ä¸Šä¼šé€€åŒ–ä¸º `INNER JOIN`ï¼Œå› ä¸º `p.created_at > '2024-01-01'` æ’é™¤äº† `NULL` å€¼ï¼ˆå³æ— å¸–å­è®°å½•çš„æƒ…å†µï¼‰ã€‚å¦‚æœç¡®å®éœ€è¦ä¿ç•™æ— å¸–å­çš„ç”¨æˆ·ï¼Œåˆ™åº”æ”¹å†™ `WHERE` æ¡ä»¶ã€‚

---

## å››ã€å¯èƒ½çš„æ€§èƒ½é—®é¢˜

### 1. **JOIN æ€§èƒ½**
- å¦‚æœ `users` è¡¨æ•°æ®é‡å¾ˆå¤§ï¼Œä¸” `posts` è¡¨æ•°æ®æ›´å¤šï¼Œé‚£ä¹ˆ `LEFT JOIN` çš„æ€§èƒ½å¯èƒ½ä¼šä¸‹é™ã€‚
- æ²¡æœ‰åˆé€‚çš„ç´¢å¼•æ—¶ï¼ŒJOIN ä¼šå˜æˆå…¨è¡¨æ‰«æã€‚

### 2. **WHERE æ¡ä»¶è¿‡æ»¤æ•ˆç‡ä½**
- å¦‚æœ `users` è¡¨ä¸­å¤§éƒ¨åˆ†ç”¨æˆ·æ˜¯ active çš„ï¼Œ`u.status = 'active'` å¯¹è¿‡æ»¤å¸®åŠ©æœ‰é™ã€‚
- å¦‚æœ `posts` ä¸­å¤§é‡å¸–å­æ—©äº `'2024-01-01'`ï¼Œè€Œæ²¡æœ‰ç´¢å¼•ï¼Œä¼šå¯¼è‡´æ‰«æå¤§é‡æ— æ•ˆæ•°æ®ã€‚

### 3. **æ’åºä¸ LIMIT çš„ä»£ä»·**
- `ORDER BY p.created_at DESC LIMIT 100` éœ€è¦å…ˆå¯¹ç¬¦åˆæ¡ä»¶çš„æ•°æ®æ’åºï¼Œå†å–å‰100æ¡ï¼Œå¤§æ•°æ®é‡ä¸‹æ€§èƒ½å¼€é”€å¤§ã€‚

---

## äº”ã€ç´¢å¼•ä½¿ç”¨æƒ…å†µåˆ†æ

å½“å‰å»ºè¡¨è¯­å¥ä¸­æœªæ˜¾å¼æŒ‡å®šç´¢å¼•ï¼Œä½†æ ¹æ®çº¦æŸè‡ªåŠ¨åˆ›å»ºäº†ä¸€äº›ç´¢å¼•ï¼š

| è¡¨å     | è‡ªåŠ¨åˆ›å»ºçš„ç´¢å¼•         | å­—æ®µ           |
|----------|------------------------|----------------|
| `users`  | PRIMARY KEY            | id             |
|          | UNIQUE INDEX           | email          |
| `posts`  | PRIMARY KEY            | id             |
|          | FOREIGN KEY (user_id)  | user_id        |
|          | æ—                      | created_at     |

### æ¨èæ·»åŠ çš„ç´¢å¼•ï¼š

#### 1. åœ¨ `users` è¡¨ä¸Šï¼š
```sql
CREATE INDEX idx_users_status ON users(status);
```
ç”¨é€”ï¼šåŠ é€Ÿ `WHERE u.status = 'active'` çš„è¿‡æ»¤ã€‚

#### 2. åœ¨ `posts` è¡¨ä¸Šï¼š
```sql
CREATE INDEX idx_posts_user_id_created_at ON posts(user_id, created_at);
```
ç”¨é€”ï¼š
- æ”¯æŒ `LEFT JOIN users u ON u.id = p.user_id`
- åŠ é€Ÿ `p.created_at > '2024-01-01'` çš„ç­›é€‰
- è¦†ç›–ç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡

---

## å…­ã€JOINæ“ä½œåˆ†æ

### ä½¿ç”¨çš„æ˜¯ `LEFT JOIN`
- å³ä½¿ç”¨æˆ·æ²¡æœ‰å¸–å­ï¼Œä¹Ÿä¼šå‡ºç°åœ¨ç»“æœä¸­ï¼ˆç†è®ºä¸Šï¼‰
- ä½† `WHERE p.created_at > '2024-01-01'` å®é™…ä¸Šæ’é™¤äº†æ‰€æœ‰ `p.created_at IS NULL` çš„æƒ…å†µï¼Œå› æ­¤ç­‰ä»·äº `INNER JOIN`

### æ”¹è¿›å»ºè®®ï¼š
å¦‚æœä½ åªæƒ³æŸ¥å‡ºé‚£äº›æœ‰æ–°å¸–å­çš„ç”¨æˆ·ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨ `INNER JOIN` æ›´åŠ è¯­ä¹‰æ¸…æ™°ï¼›å¦åˆ™åº”è°ƒæ•´ WHERE æ¡ä»¶ä»¥å…è®¸ç©ºå¸–å­ã€‚

---

## ä¸ƒã€WHEREæ¡ä»¶åˆ†æ

### å½“å‰æ¡ä»¶ï¼š
```sql
WHERE u.status = 'active'
AND p.created_at > '2024-01-01'
```

### åˆ†æï¼š
- `u.status = 'active'`ï¼šç”¨äºç­›é€‰æœ‰æ•ˆç”¨æˆ·ï¼›
- `p.created_at > '2024-01-01'`ï¼šåªå…³æ³¨è¿‘æœŸå¸–å­ã€‚

### æ½œåœ¨ä¼˜åŒ–ï¼š
- å¦‚æœ `users` è¡¨éå¸¸å¤§ï¼Œè€Œ active ç”¨æˆ·å æ¯”ä¸é«˜ï¼Œå¯è€ƒè™‘å¢åŠ  `idx_users_status` æé«˜æ•ˆç‡ï¼›
- å¦‚æœ `posts` è¡¨ä¸­å¤§éƒ¨åˆ†å¸–å­ä¸æ˜¯ 2024 å¹´åå‘å¸ƒï¼Œå»ºè®®å»ºç«‹ `(user_id, created_at)` çš„è”åˆç´¢å¼•ã€‚

---

## å…«ã€æ½œåœ¨çš„å®‰å…¨é£é™©

### 1. **SQLæ³¨å…¥é£é™©**
- å¦‚æœè¯¥è¯­å¥æ˜¯åŠ¨æ€æ‹¼æ¥ç”Ÿæˆçš„ï¼Œä¸”å‚æ•°ï¼ˆå¦‚æ—¥æœŸ `'2024-01-01'`ï¼‰æ¥è‡ªå¤–éƒ¨è¾“å…¥ï¼Œå­˜åœ¨ SQL æ³¨å…¥é£é™©ã€‚
- âœ… **å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥æˆ– ORM å‚æ•°åŒ–æŸ¥è¯¢**ã€‚

### 2. **æ•æ„Ÿå­—æ®µæš´éœ²**
- æŸ¥è¯¢è¿”å›äº†ç”¨æˆ·çš„ `email` å­—æ®µï¼Œå¦‚æœæ˜¯å¯¹å¤–æ¥å£ï¼Œéœ€ç¡®è®¤æ˜¯å¦å…è®¸æš´éœ²ç”¨æˆ·éšç§ä¿¡æ¯ã€‚
- âœ… **å»ºè®®æ ¹æ®æƒé™æ§åˆ¶è¿”å›å­—æ®µï¼Œå¿…è¦æ—¶è„±æ•å¤„ç†ã€‚**

### 3. **æ•°æ®æ³„éœ²é£é™©**
- è‹¥æ­¤æŸ¥è¯¢è¢«æ¶æ„åˆ©ç”¨ï¼Œå¯èƒ½å¯¼è‡´æ‰¹é‡è·å–ç”¨æˆ·åŠå¸–å­ä¿¡æ¯ã€‚
- âœ… **å»ºè®®åŠ ä¸Šè®¿é—®æ§åˆ¶ã€åˆ†é¡µæœºåˆ¶ã€é¢‘ç‡é™åˆ¶ç­‰å®‰å…¨æªæ–½ã€‚**

---

## âœ… æ€»ç»“ä¸å»ºè®®

| æ–¹é¢              | åˆ†æç»“è®º                                                                 |
|-------------------|----------------------------------------------------------------------------|
| åŠŸèƒ½ç›®çš„          | è·å– 2024 å¹´ä»¥æ¥æ´»è·ƒç”¨æˆ·çš„æ–°å¸–å­                                           |
| JOIN ç±»å‹         | ä½¿ç”¨ LEFT JOINï¼Œä½†å®é™…æ•ˆæœç­‰åŒ INNER JOIN                                  |
| æ€§èƒ½ç“¶é¢ˆ          | ä¸»è¦åœ¨ JOINã€WHERE è¿‡æ»¤ã€ORDER BY ä¸Šï¼Œå°¤å…¶åœ¨æ•°æ®é‡å¤§æ—¶                    |
| ç´¢å¼•å»ºè®®          | å»ºè®®åœ¨ `users.status`ã€`posts(user_id, created_at)` æ·»åŠ ç´¢å¼•              |
| å®‰å…¨å»ºè®®          | å‚æ•°åŒ–æŸ¥è¯¢ã€å­—æ®µè„±æ•ã€æƒé™æ§åˆ¶                                             |
| å¯æ”¹è¿›ç‚¹          | æ˜ç¡®æ˜¯å¦éœ€è¦ LEFT JOINï¼›ä¼˜åŒ–æ’åºæ–¹å¼ï¼›é¿å…ä¸å¿…è¦çš„å­—æ®µè¿”å›                |

---

å¦‚æœ‰è¿›ä¸€æ­¥éœ€æ±‚ï¼ˆä¾‹å¦‚æ‰§è¡Œè®¡åˆ’åˆ†æã€æ…¢æŸ¥è¯¢æ—¥å¿—ä¼˜åŒ–ã€å…·ä½“ç´¢å¼•è®¾è®¡ï¼‰ï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼

## ä¼˜åŒ–å»ºè®®

# MySQL æŸ¥è¯¢ä¼˜åŒ–å»ºè®®ï¼ˆåŸºäºç»™å®šSQLåˆ†æï¼‰

---

## 1. ç´¢å¼•ä¼˜åŒ–å»ºè®®

### âœ… å»ºè®®æ·»åŠ çš„ç´¢å¼•ï¼š

#### ï¼ˆ1ï¼‰`users` è¡¨ï¼š
```sql
CREATE INDEX idx_users_status ON users(status);
```
> **ç”¨é€”**ï¼šåŠ é€Ÿ `WHERE u.status = 'active'` çš„è¿‡æ»¤ã€‚

#### ï¼ˆ2ï¼‰`posts` è¡¨ï¼š
```sql
CREATE INDEX idx_posts_user_id_created_at ON posts(user_id, created_at);
```
> **ç”¨é€”**ï¼š
- æ”¯æŒ JOIN æ¡ä»¶ `u.id = p.user_id`
- åŠ é€Ÿ `p.created_at > '2024-01-01'` çš„ç­›é€‰
- è”åˆç´¢å¼•æ”¯æŒè¦†ç›–ç´¢å¼•æ‰«æï¼Œé¿å…å›è¡¨æŸ¥è¯¢

#### ï¼ˆ3ï¼‰å¯é€‰ç´¢å¼•ï¼ˆå¦‚æœåç»­éœ€è¦æŒ‰æ—¶é—´æ’åºåˆ†é¡µï¼‰ï¼š
```sql
CREATE INDEX idx_posts_created_at ON posts(created_at DESC);
```
> **ç”¨é€”**ï¼šæå‡ `ORDER BY p.created_at DESC LIMIT 100` çš„æ€§èƒ½ã€‚

---

## 2. æŸ¥è¯¢é‡å†™å»ºè®®

### âš ï¸ å½“å‰é—®é¢˜ï¼š
- ä½¿ç”¨äº† `LEFT JOIN`ï¼Œä½† `WHERE p.created_at > '2024-01-01'` å®é™…ä¸Šæ’é™¤äº†æ— å¸–å­è®°å½•çš„æƒ…å†µã€‚
- ç›¸å½“äºæ‰§è¡Œäº† `INNER JOIN`ï¼Œè¯­ä¹‰ä¸æ¸…æ™°ã€‚

### âœ… å»ºè®®æ”¹å†™ä¸º `INNER JOIN` å¹¶æ˜ç¡®æ„å›¾ï¼š
```sql
SELECT u.id, u.name, u.email, p.title, p.content, p.created_at
FROM users u
INNER JOIN posts p ON u.id = p.user_id
WHERE u.status = 'active'
  AND p.created_at > '2024-01-01'
ORDER BY p.created_at DESC
LIMIT 100;
```

### ğŸ“Œ è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®ï¼š

#### ï¼ˆ1ï¼‰ä½¿ç”¨å­æŸ¥è¯¢å‡å°‘JOINæ•°æ®é‡ï¼ˆé€‚åˆå¤§æ•°æ®åœºæ™¯ï¼‰ï¼š
```sql
SELECT u.id, u.name, u.email, p.title, p.content, p.created_at
FROM (
    SELECT id
    FROM users
    WHERE status = 'active'
) u_sub
JOIN users u ON u.id = u_sub.id
JOIN posts p ON u.id = p.user_id
WHERE p.created_at > '2024-01-01'
ORDER BY p.created_at DESC
LIMIT 100;
```
> **è¯´æ˜**ï¼šå…ˆè¿‡æ»¤å‡ºæ´»è·ƒç”¨æˆ·IDï¼Œå†è¿›è¡Œè¿æ¥ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘JOINçš„æ•°æ®é‡ã€‚

---

## 3. è¡¨ç»“æ„ä¼˜åŒ–å»ºè®®

### âœ… å½“å‰ç»“æ„åŸºæœ¬åˆç†ï¼Œä½†å¯è€ƒè™‘ä»¥ä¸‹æ”¹è¿›ï¼š

#### ï¼ˆ1ï¼‰å¢åŠ å†—ä½™å­—æ®µï¼ˆç”¨äºé«˜æ€§èƒ½è¯»å–ï¼‰
å¦‚æœç»å¸¸éœ€è¦æ ¹æ® `user_id` å’Œ `created_at` æŸ¥è¯¢å¸–å­ï¼Œå¯ä»¥è€ƒè™‘åœ¨ `posts` è¡¨ä¸­å¢åŠ ä¸€ä¸ªå­—æ®µæ¥è¡¨ç¤ºæ˜¯å¦æ˜¯â€œæ–°å¸–â€ï¼Œå¹¶å»ºç«‹ç´¢å¼•ï¼š

```sql
ALTER TABLE posts ADD COLUMN is_recent BOOLEAN AS (created_at > '2024-01-01') STORED;
CREATE INDEX idx_posts_is_recent ON posts(is_recent);
```

> **ç”¨é€”**ï¼šåŠ å¿« `created_at > '2024-01-01'` çš„è¿‡æ»¤é€Ÿåº¦ã€‚

#### ï¼ˆ2ï¼‰åˆ†åŒºè¡¨ï¼ˆé€‚ç”¨äºå¤§æ•°æ®é‡åœºæ™¯ï¼‰
å¦‚æœ `posts` è¡¨æ•°æ®é‡éå¸¸å¤§ï¼ˆç™¾ä¸‡çº§ä»¥ä¸Šï¼‰ï¼Œå¯è€ƒè™‘æŒ‰æ—¶é—´èŒƒå›´å¯¹ `posts` è¡¨è¿›è¡Œåˆ†åŒºï¼š

```sql
ALTER TABLE posts
PARTITION BY RANGE (YEAR(created_at)) (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

> **ç”¨é€”**ï¼šä½¿ `created_at > '2024-01-01'` åªæ‰«ææœ€æ–°çš„åˆ†åŒºï¼Œæå‡æ•ˆç‡ã€‚

---

## 4. æ€§èƒ½ä¼˜åŒ–æŠ€å·§

| æŠ€å·§ | æè¿° |
|------|------|
| é¿å… SELECT * | æ˜ç¡®åˆ—å‡ºæ‰€éœ€å­—æ®µï¼Œå‡å°‘IOå’Œå†…å­˜å¼€é”€ |
| åˆ†é¡µä¼˜åŒ– | å¦‚æœæ˜¯åˆ†é¡µæŸ¥è¯¢ï¼Œå¯å…ˆè·å–ä¸»é”®IDï¼Œå†JOINè¯¦æƒ…è¡¨ |
| å»ºç«‹å¤åˆç´¢å¼• | å¯¹å¤šä¸ªæ¡ä»¶ç»„åˆæŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨è”åˆç´¢å¼•æ›´é«˜æ•ˆ |
| æ§åˆ¶è¿”å›è¡Œæ•° | åˆç†ä½¿ç”¨ LIMITï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ® |
| å‡å°‘JOINå±‚çº§ | å°½å¯èƒ½å‡å°‘JOINæ•°é‡ï¼Œæˆ–æå‰è¿‡æ»¤å‡å°‘ä¸­é—´ç»“æœé›† |

---

## 5. æœ€ä½³å®è·µå»ºè®®

| ç±»åˆ« | æ¨èåšæ³• |
|------|----------|
| SQL å†™æ³• | æ˜ç¡®æŒ‡å®šå­—æ®µï¼Œé¿å… `SELECT *` |
| ç´¢å¼•è®¾è®¡ | å¯¹é¢‘ç¹æŸ¥è¯¢å­—æ®µã€JOINå­—æ®µã€æ’åºå­—æ®µå»ºç«‹åˆé€‚ç´¢å¼• |
| æ•°æ®å®‰å…¨ | ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥ï¼›æ•æ„Ÿå­—æ®µè„±æ•å¤„ç† |
| åˆ†é¡µæœºåˆ¶ | ä½¿ç”¨å»¶è¿Ÿå…³è”ï¼ˆDeferred Joinï¼‰å®ç°é«˜æ•ˆåˆ†é¡µ |
| æŸ¥è¯¢è®¡åˆ’ | å®šæœŸæŸ¥çœ‹ `EXPLAIN` è¾“å‡ºï¼Œç¡®è®¤ç´¢å¼•å‘½ä¸­æƒ…å†µ |
| æ•°æ®åº“é…ç½® | æ ¹æ®ä¸šåŠ¡è´Ÿè½½è°ƒæ•´ç¼“å†²æ± å¤§å°ã€è¿æ¥æ•°ç­‰å‚æ•° |

---

## 6. ä¼˜åŒ–åçš„SQLç¤ºä¾‹

### ç¤ºä¾‹ä¸€ï¼šæ ‡å‡†ä¼˜åŒ–ç‰ˆï¼ˆæ¨èï¼‰
```sql
SELECT u.id, u.name, u.email, p.title, p.content, p.created_at
FROM users u
INNER JOIN posts p ON u.id = p.user_id
WHERE u.status = 'active'
  AND p.created_at > '2024-01-01'
ORDER BY p.created_at DESC
LIMIT 100;
```

### ç¤ºä¾‹äºŒï¼šå»¶è¿Ÿå…³è”ä¼˜åŒ–ï¼ˆé€‚åˆå¤§æ•°æ®ï¼‰
```sql
SELECT u.id, u.name, u.email, p.title, p.content, p.created_at
FROM (
    SELECT user_id
    FROM posts
    WHERE created_at > '2024-01-01'
    ORDER BY created_at DESC
    LIMIT 100
) p_sub
JOIN users u ON p_sub.user_id = u.id
JOIN posts p ON p.user_id = u.id AND p.created_at > '2024-01-01'
WHERE u.status = 'active';
```

> **è¯´æ˜**ï¼šå…ˆä» `posts` ä¸­æ‰¾å‡ºæœ€è¿‘100æ¡è®°å½•çš„ `user_id`ï¼Œå†ä¸ `users` å…³è”ï¼Œå‡å°‘ä¸å¿…è¦çš„JOINæ•°æ®é‡ã€‚

---

## 7. é¢„æœŸçš„æ€§èƒ½æå‡æ•ˆæœ

| ä¼˜åŒ–ç‚¹ | é¢„æœŸæ•ˆæœ |
|--------|----------|
| æ·»åŠ ç´¢å¼• `idx_users_status` | å‡å°‘ users è¡¨å…¨è¡¨æ‰«æï¼Œæé«˜ WHERE æ•ˆç‡ |
| æ·»åŠ ç´¢å¼• `idx_posts_user_id_created_at` | æå‡ JOIN å’Œ WHERE æ€§èƒ½ï¼Œå¯èƒ½è¾¾åˆ°è¦†ç›–ç´¢å¼• |
| ä½¿ç”¨ INNER JOIN æ›¿ä»£ LEFT JOIN | å‡å°‘æ— æ•ˆæ•°æ®å¤„ç†ï¼Œæå‡æ‰§è¡Œæ•ˆç‡ |
| å»¶è¿Ÿå…³è”ä¼˜åŒ– | å¤§å¹…å‡å°‘ä¸­é—´ç»“æœé›†ï¼Œå°¤å…¶åœ¨æ•°æ®é‡å¤§æ—¶ |
| åˆ†åŒºè¡¨ | æé«˜æ—¶é—´èŒƒå›´æŸ¥è¯¢çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å†å²æ•°æ®éš”ç¦» |
| EXPLAIN åˆ†æ | å¯ä»¥éªŒè¯ç´¢å¼•å‘½ä¸­æƒ…å†µï¼Œé¿å…æ€§èƒ½é»‘æ´ |

---

## âœ… é™„å½•ï¼šæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’å‘½ä»¤

```sql
EXPLAIN
SELECT u.id, u.name, u.email, p.title, p.content, p.created_at
FROM users u
INNER JOIN posts p ON u.id = p.user_id
WHERE u.status = 'active'
  AND p.created_at > '2024-01-01'
ORDER BY p.created_at DESC
LIMIT 100;
```

> **å…³æ³¨ç‚¹**ï¼š
- `type` åˆ—åº”å°½é‡ä¸º `ref` æˆ– `range`
- `Extra` åˆ—ä¸åº”å‡ºç° `Using filesort` æˆ– `Using temporary`

---

å¦‚éœ€è¿›ä¸€æ­¥åˆ†ææ‰§è¡Œè®¡åˆ’ã€æ…¢æŸ¥è¯¢æ—¥å¿—æˆ–åšå‹æµ‹å¯¹æ¯”ï¼Œè¯·ç»§ç»­æé—®ï¼

## å…ƒæ•°æ®ä¿¡æ¯

| é¡¹ç›® | å€¼ |
| --- | --- |
| validation_time | 2025-07-16T16:26:32.586204 |
| sql_length | 242 |
| database_type | MySQL |
| analysis_time | 2025-07-16T16:27:42.872953 |
| analysis_length | 4479 |
| optimization_time | 2025-07-16T16:28:42.348368 |
| optimization_length | 3927 |

---
*æœ¬æŠ¥å‘Šç”±SQLä¼˜åŒ–å·¥å…·è‡ªåŠ¨ç”Ÿæˆ*
